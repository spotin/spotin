{% extends "public-layout.njk" %}

{% block body %}
  <article>
    <header>
      {% if spot.name != null %}
        <h1>
          <i class="fas fa-map-marker-alt"></i>
          {{ spot.name }}
        </h1>
      {% else %}
        <h1 class="text-italic">
          <i class="fas fa-map-marker-alt"></i>
          {{ t('ui.spots.view.noName') }}
        </h1>
      {% endif %}
      <p>
        <a href="#">#nature</a>
        <a href="#">#mountain</a>
        <a href="#">#switzerland</a>
      </p>
      <p>
        <i class="fas fa-user"></i>
        Spot created by
        <a href="/profile/{{ spot.user.username }}">{{ spot.user.username }}</a>
      </p>
      {% if spot.user.role == "CERTIFIED_USER" or spot.user.role == "ADMIN" %}
        <p>
          <span style="color: LimeGreen;">
            <i class="fas fa-check-circle"></i>
          </span>
          Verified by Spot in
        </p>
      {% endif %}
      <details>
        <summary>
          <span style="color: DodgerBlue;">
            <i class="fas fa-info-circle"></i>
          </span>
          Learn more about Spot in
        </summary>
        <p>
          Spot in is a platform that allows you to share your favorite spots with the world. You can create a spot by providing a name, a description, and a website target. You can also provide the latitude and longitude of the spot to display it on a map.
        </p>
      </details>
    </header>

    <p>
      {% if spot.description != null %}
        {{ spot.description }}
      {% else %}
        <span class="text-italic">{{ t('ui.spots.view.noDescription') }}</span>
      {% endif %}
    </p>

    {% if spot.latitude != null and spot.longitude != null %}
      <div id='map' style='width: 100%; height: 400px;'></div>
    {% endif %}

    <footer>
      {% if spot.websiteTarget != null %}
        <p>
          You are about to leave Spot in and visit
          {{ spot.websiteTarget }}.
        </p>

        <p>
          To access this website, click on the button below.
        </p>
        <form id="form">
          <button type="submit">
            <i class="fas fa-external-link-alt"></i>
            Access
            {{ spot.websiteTarget }}
          </button>
        </form>
      {% endif %}

      <div role="group">
        <button class="secondary">
          <i class="fas fa-flag"></i>
          Report
        </button>
        <button class="secondary">
          <span style="color: Red;">
            <i class="fas fa-heart"></i>
          </span>
          Like
        </button>
        <button class="secondary">
          <i class="fas fa-share-alt"></i>
          Share
        </button>
      </div>
    </footer>
  </article>
{% endblock %}

{% block javascript %}
  <script>
    const longitude = '{{ spot.longitude }}';
    const latitude = '{{ spot.latitude }}';

    if (longitude !== '' && latitude !== '') {
      const map = new maplibregl.Map({
        container: 'map',
        style: "https://vectortiles.geo.admin.ch/styles/ch.swisstopo.leichte-basiskarte_world.vt/style.json",
        center: [
          longitude, latitude
        ],
        zoom: 10
      });

      const marker = new maplibregl
        .Marker({color: "#e53935"})
        .setLngLat([longitude, latitude])
        .addTo(map);
    }

    {% if spot.websiteTarget %}
      const form = document.getElementById("form");

      form.addEventListener("submit", async (event) => {
        event.preventDefault();

        window.location.href = "{{ spot.websiteTarget }}";
      });
    {% endif %}
  </script>
{% endblock %}
